Parte 1: Estructura de la base de datos


*1 Crear tabla de usuarios

CREATE TABLE usuarios(
id INT AUTO_INCREMENT PRIMARY KEY,
nombre VARCHAR(200) NOT NULL,
apellido VARCHAR(200) NOT NULL,
email VARCHAR(200) UNIQUE,
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)

-----------

*2 Crear tabla de productos

CREATE TABLE productos(
id INT AUTO_INCREMENT PRIMARY KEY,
nombre VARCHAR(200),
precio DECIMAL(10,2),
stock INT,
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
)

-----------

*3 Crear tabla compras

CREATE TABLE compras(
id INT AUTO_INCREMENT PRIMARY KEY,
usuario_id INT,
fecha DATE DEFAULT CURRENT_DATE,
total DECIMAL(10,2),
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
)

-----------

*4 Crear tabla detalles compras

CREATE TABLE detalles_compras(
id INT AUTO_INCREMENT PRIMARY KEY,
compra_id INT,
producto_id INT,
cantidad INT,
precio_unitario DECIMAL(10,2),
fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
FOREIGN KEY (compra_id) REFERENCES compras(id),
FOREIGN KEY (producto_id) REFERENCES productos(id)    
)



Parte 2: Ejercicios de Manipulacion de datos

###A--Ejercicios de insertar datos

1-Registrar usuarios

INSERT INTO `usuarios`(`nombre`, `apellido`, `email`) VALUES ('Ana','Lopez','ana@gmailcom')

INSERT INTO `usuarios`(`nombre`, `apellido`, `email`) VALUES ('Carlos','Ruiz','carlos@gmailcom')

INSERT INTO `usuarios`(`nombre`, `apellido`, `email`) VALUES ('Maria','Gomez','maria@gmailcom')

-----------

2-Inventario inicial

INSERT INTO `productos`( `nombre`, `precio`, `stock`) VALUES ('laptop', 1000.00, 20)

INSERT INTO `productos`( `nombre`, `precio`, `stock`) VALUES ('mouse', 90.00, 3)

INSERT INTO `productos`( `nombre`, `precio`, `stock`) VALUES ('Monitor', 500.00, 10)

INSERT INTO `productos`( `nombre`, `precio`, `stock`) VALUES ('auriculares', 40.00, 100)

INSERT INTO `productos`( `nombre`, `precio`, `stock`) VALUES ('Teclado', 80.00, 50)

-----------

3-Simular una compra

*Crear una insercion en la tabla compras para el usuario Ana Lopez

INSERT INTO `compras`(`usuario_id`, `total`) VALUES (1, 0.00)

-----------

*Insertar dos registros

ana lopez compro una laptop y dos mouse

INSERT INTO `detalles_compras`( `compra_id`, `producto_id`, `cantidad`, `precio_unitario`) VALUES (1 , 1 , 1, 1000.00)

INSERT INTO `detalles_compras`( `compra_id`, `producto_id`, `cantidad`, `precio_unitario`) VALUES (1 , 2 , 2, 90.00)




###B--Ejercicios de buscar datos

*listar productos: lista de todos los productos con nombre y precio:

SELECT nombre, precio FROM `productos` 

-----------

*filtro de productos cuyo precio sea mayor a 100:

SELECT nombre, precio FROM `productos` WHERE precio > 100

-----------

*Búsqueda de Usuario: Encuentra el correo electrónico del usuario cuyo nombre es 'Carlos Ruiz'

SELECT email FROM `usuarios` WHERE nombre = 'Carlos' AND apellido = 'Ruiz' 

-----------

*Stock Bajo: Muestra los productos que tienen menos de 5 unidades en stock.

SELECT nombre, stock FROM `productos` WHERE stock < 5



#### C. Ejercicios de Buscar Datos Relacionales (JOINS)

*Historial de Compras: Muestra una lista que incluya el nombre del usuario y la fecha de cada compra que ha realizado (Usa INNER JOIN entre usuarios y compras):

SELECT c.fecha , u.nombre FROM compras c INNER JOIN usuarios u ON c.usuario_id = u.id

-----------

*Detalle de Factura:* Muestra el nombre del producto, la cantidad comprada y el precio unitario para una compra específica (filtra por un id de compra):

SELECT p.nombre, d.cantidad, d.precio_unitario FROM detalles_compras d INNER JOIN productos p ON p.id = d.producto_id WHERE compra_id=1

-----------

*Compras por Usuario: Obtén el nombre del usuario y el nombre de los productos que ha comprado en toda su historia (Requiere unir usuarios, compras, detalles_compras y productos):

SELECT u.nombre, p.nombre FROM usuarios u INNER JOIN compras c ON c.usuario_id = u.id INNER JOIN detalles_compras d ON d.compra_id = c.id INNER JOIN productos p ON d.producto_id = p.id

-----------

#### D. Ejercicios de Actualizar Datos (UPDATE)

*Ajuste de Precios: aumenta el precio de todos los productos en un 10%

UPDATE `productos` SET `precio`= precio * 1.10

-----------

*Actualizar Stock: El usuario 'Ana López' acaba de comprar productos; actualiza el stock de la tabla productos restando la cantidad comprada en el ejercicio 3

UPDATE productos p INNER JOIN detalles_compras d ON d.producto_id=p.id INNER JOIN compras c ON c.id= d.compra_id SET `stock`= stock - d.cantidad WHERE c.usuario_id = 1

-----------

*Corrección de Datos: Cambia el correo electrónico del usuario 'Maria Gomez' a 'maria.nuevo@mail.com'

UPDATE usuarios SET email='maria.nuevo@mail.com' WHERE id = 3

-----------

*Cancelar Detalle: Borra uno de los ítems de la tabla detalles_compras (como si el usuario hubiera devuelto un producto):

DELETE FROM `detalles_compras` WHERE compra_id = 1 AND producto_id = 2

-----------

*Eliminar Producto: Intenta borrar un producto que no ha sido vendido nunca:

DELETE FROM `productos` WHERE id = 4

----------------------

*Limpieza de Usuarios:  Borra a los usuarios que no han realizado ninguna compra (Usa una subconsulta o LEFT JOIN para identificarlos):

Para identificarlos: 

SELECT u.id FROM usuarios u LEFT JOIN compras c ON u.id = c.usuario_id WHERE c.id is NULL

Para eliminarlos:

DELETE FROM usuarios WHERE id IN (2, 3)






